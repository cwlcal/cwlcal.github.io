<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>산업재해보상보험 청력(난청) 장해 계산기</title>

  <!-- ✅ Google AdSense (head에 삽입) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1526124944243211"
     crossorigin="anonymous"></script>

  <style>
    :root{
      --bg:#ffffff;
      --text:#111;
      --muted:#666;
      --line:#1aa0a0;
      --card:#f7fbfb;
      --input:#e7ffff;
      --btn:#0c7f7f;
      --btnText:#fff;
      --danger:#c1121f;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 16px;

      /* ✅ 6분법 라벨(Hz) 칸 폭: row/헤더 정렬에 같이 사용 */
      --freqCol: 58px; /* PC 기본 */
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "돋움", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    header{
      position: sticky;
      top:0;
      z-index:10;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      line-height:1.1;
    }
    .brand .t1{ font-weight:800; font-size: 16px; }
    .brand .t2{ font-size: 12px; color:var(--muted); }
    .navbtns{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border:none;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight:800;
      background: var(--btn);
      color: var(--btnText);
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(12,127,127,.20);
    }
    .btn.secondary{
      background: #e9f3f3;
      color:#0b5e5e;
      box-shadow:none;
      border:1px solid rgba(0,0,0,.08);
    }
    .btn.ghost{
      background: transparent;
      color:#0b5e5e;
      box-shadow:none;
      border:1px solid rgba(12,127,127,.25);
    }

    main .wrap{
      padding-top: 18px;
      padding-bottom: 30px;
    }

    .page{ display:none; }
    .page.active{ display:block; }

    .hero{
      background: linear-gradient(180deg, #f2ffff, #ffffff);
      border:1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .hero h1{ margin:0 0 8px 0; font-size: 20px; }
    .hero p{
      margin:0;
      color:var(--muted);
      font-weight:600;
      line-height:1.5;
      font-size: 14px;
    }
    .toc{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 620px){
      .toc{ grid-template-columns: 1fr; }
    }
    .tocCard{
      background: var(--card);
      border:1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 140px;
    }
    .tocCard .title{ font-weight:900; font-size: 16px; }
    .tocCard .desc{
      color:var(--muted);
      font-weight:600;
      line-height:1.5;
      font-size: 13px;
      flex:1;
    }

    .sectionTitle{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin: 8px 0 12px 0;
    }
    .sectionTitle h2{
      margin:0;
      font-size: 18px;
      font-weight:900;
    }
    .sectionTitle .sub{
      margin:0;
      color:var(--muted);
      font-weight:700;
      font-size: 12px;
    }

    .card{
      background: var(--card);
      border:1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .line{
      height:2px;
      background: var(--line);
      opacity:.7;
      border-radius:999px;
      margin: 14px 0;
    }

    .grid{ display:grid; gap: 10px; }
    .grid.cols4{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    .grid.cols3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    .grid.cols2{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (max-width: 720px){
      .grid.cols4{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .grid.cols3{ grid-template-columns: repeat(1, minmax(0,1fr)); }
      .grid.cols2{ grid-template-columns: repeat(1, minmax(0,1fr)); }
    }

    .field label{
      display:block;
      font-weight:900;
      font-size: 13px;
      margin-bottom: 6px;
    }

    .input{
      width:100%;
      height: 34px;
      border-radius: 12px;
      border:1px solid rgba(0,0,0,.10);
      background: var(--input);
      padding: 6px 10px;
      font-size: 14px;
      outline:none;
      user-select:text;
      -webkit-user-select:text;
      pointer-events:auto;
      appearance: none;
      -webkit-appearance: none;
      min-width: 0;
      max-width: 100%;
    }
    select.input{
      cursor:pointer;
      background: #e7ffff;
    }
    .input[readonly]{
      background:#eef7f7;
      color:#0b5e5e;
      font-weight:900;
    }
    .help{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      font-weight:700;
    }

    .resultBox{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border:1px dashed rgba(12,127,127,.35);
      background: #ffffff;
      font-weight:900;
      line-height:1.4;
    }
    .resultBox .muted{
      color: var(--muted);
      font-weight:800;
      font-size: 12px;
      margin-top: 6px;
      white-space: pre-wrap;
    }
    .err{
      color: var(--danger);
      font-weight:900;
      margin-top: 10px;
    }

    /* -----------------------------
       6분법 (모바일 오버플로우 해결 + PC 정렬 개선)
    ----------------------------- */

    .sessions{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      position: relative;
      z-index: 2;
    }
    @media (min-width: 1400px){
      .sessions{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    @media (max-width: 980px){
      .sessions{ grid-template-columns: 1fr; }
    }

    .sessionCard{
      background:#fff;
      border:1px solid rgba(0,0,0,.07);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
      position: relative;
      z-index: 2;
    }
    .sessionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom: 10px;
    }
    .sessionHead .sTitle{ font-weight:1000; font-size: 16px; }

    /* ✅ 모바일에서도 좌/우 2칸 유지 */
    .pair{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .earBlock{
      background: var(--card);
      border:1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      padding: 12px;
      min-width: 0;
      overflow: hidden;
      position: relative;
      z-index: 3;
    }

    /* ✅ '결과' 헤더가 입력칸 컬럼과 딱 맞게 정렬 */
    .earBlock .earTitle{
      display:grid;
      grid-template-columns: var(--freqCol) minmax(0, 1fr);
      align-items:center;
      margin-bottom: 8px;
      font-weight:1000;
    }
    .earBlock .earTitle span:last-child{
      justify-self:center;
      text-align:center;
      font-weight:1000;
      color:#0b5e5e;
    }

    .freqGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
      min-width: 0;
    }

    .row{
      display:grid;
      grid-template-columns: var(--freqCol) minmax(0, 1fr);
      gap: 10px;
      align-items:center;
      min-width: 0;
    }
    .row .freq{
      font-weight:900;
      color:#0b5e5e;
      white-space:nowrap;
    }
    .row input.input{
      min-width: 0 !important;
      max-width: 100%;
      width: 100%;
      justify-self: stretch;
    }

    @media (max-width: 520px){
      :root{ --freqCol: 52px; }
      .pair{ gap: 8px; }
      .earBlock{ padding: 10px; }
      .row{ gap: 8px; }
      .row .freq{ font-size: 13px; }
      .input{ height: 32px; padding: 6px 8px; font-size: 13px; }
      .sessionCard{ padding: 12px; }
    }
    @media (max-width: 390px){
      :root{ --freqCol: 48px; }
      .pair{ gap: 6px; }
      .row{ gap: 6px; }
      .row .freq{ font-size: 12px; }
      .input{ height: 30px; padding: 5px 7px; font-size: 12px; border-radius: 10px; }
    }

    /* ✅ PC에서 입력칸 3자리(100)까지 안정적으로 보이도록 */
    @media (min-width: 521px){
      #page-six .row input.input{ min-width: 104px !important; }
    }

    /* ✅ PC에서 전체 폭 넓히기 + 3회차 3열을 노트북에서도 */
    @media (min-width: 1100px){
      .wrap{ max-width: 1240px; }
      .sessions{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    /* 장해 일시금·연금 비교 테이블 */
    .miniTable{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid rgba(0,0,0,.08);
      background:#fff;
      box-shadow: var(--shadow);
    }
    .miniTable th, .miniTable td{
      padding: 10px 10px;
      font-size: 13px;
      border-bottom:1px solid rgba(0,0,0,.06);
      text-align:right;
      white-space:nowrap;
    }
    .miniTable th{
      background:#f3fbfb;
      font-weight:900;
      text-align:left;
    }
    .miniTable tr:last-child td, .miniTable tr:last-child th{ border-bottom:none; }
    .miniTable td:first-child{ text-align:left; font-weight:900; color:#0b5e5e; }
    .badge{
      display:inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight:900;
      font-size: 12px;
      background:#e9f3f3;
      color:#0b5e5e;
      border:1px solid rgba(0,0,0,.08);
    }
  
  /* ============================
     ✅ 6분법 PC 입력칸(3자리)만 '살짝' + 결과 헤더 정렬 (오버라이드)
     - 입력칸이 화면 가득 늘어나지 않게 고정폭(문자 기준) 적용
     - 최대값 100(3자리)만 편하게 보이게
     ============================ */

  /* 라벨(Hz) 칸 폭을 변수로 통일 */
  :root{ --freqCol: 58px; }

  /* PC에서 전체 폭(컨테이너) 약간 넓게 */
  @media (min-width: 1100px){
    .wrap{ max-width: 1240px; }
    .sessions{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  }

  /* '결과' 헤더를 row 컬럼 구조로 맞춤 */
  .earBlock .earTitle{
    display:grid !important;
    grid-template-columns: var(--freqCol) minmax(0, 1fr);
    align-items:center;
  }

  /* row도 동일 변수로 맞춤 */
  #page-six .row{
    grid-template-columns: var(--freqCol) minmax(0, 1fr);
  }

  /* ✅ 핵심: PC에서 입력칸이 '조금만' 넓고, 더 이상 늘어나지 않게 */
  @media (min-width: 521px){
    #page-six .row input.input{
      width: 6.5ch !important;      /* 3자리 + 약간 여유 */
      min-width: 6.5ch !important;
      max-width: 72px !important;   /* 너무 길어지는 것 방지 */
      justify-self: end;
      text-align: center;
    }
    /* '결과' 글자도 입력칸 폭/위치에 맞춤 */
    #page-six .earBlock .earTitle span:last-child{
      justify-self: end;
      width: 6.5ch;
      text-align: center;
    }
  }

  /* 모바일/초소형에서 라벨폭만 유지 */
  @media (max-width: 520px){ :root{ --freqCol: 52px; } }
  @media (max-width: 390px){ :root{ --freqCol: 48px; } }

</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <div class="t1">산재보험 청력 장해등급 계산기</div>
          <div class="t2">목차 → 계산기 선택 (PC/모바일 반응형)</div>
        </div>
        <div class="navbtns">
          <button class="btn secondary" id="btnHome">목차</button>
          <button class="btn ghost" id="btnPrint">인쇄</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">

      <!-- HOME -->
      <section class="page active" id="page-home">
        <div class="hero">
          <h1>처음 화면(목차)</h1>
          <p>
            아래 버튼을 눌러 원하는 계산기로 이동하세요.<br/>
            ※ 숫자는 공백/콤마(예: 1,000) 입력도 가능합니다.
          </p>

          <div class="toc">
            <div class="tocCard">
              <div class="title">① 산재보험 청력 장해등급 계산기</div>
              <div class="desc">
                좌/우 dB, 좌/우 어음명료도(%)를 입력하면<br/>
                테이블 기준으로 급수를 표시합니다.
              </div>
              <button class="btn" data-go="grade">장해등급 계산기 열기</button>
            </div>

            <div class="tocCard">
              <div class="title">② 청력 6분법 평균 계산기</div>
              <div class="desc">
                1~3회차, 좌/우 각각 500/1000/2000/4000Hz 입력 →<br/>
                6분법 평균(내림, 최대 100) 자동 계산
              </div>
              <button class="btn" data-go="six">6분법 평균 계산기 열기</button>
            </div>

            <div class="tocCard">
              <div class="title">③ 장해 일시금·연금 계산기</div>
              <div class="desc">
                장해등급과 평균임금, 지급방식(일시금/연금)을 선택하면<br/>
                산정일수·금액 및 비교(예상값)를 표시합니다.
              </div>
              <button class="btn" data-go="janghae">장해 일시금·연금 계산기 열기</button>
            </div>

          </div>
        </div>
      </section>

      <!-- GRADE -->
      <section class="page" id="page-grade">
        <div class="sectionTitle">
          <div>
            <h2>※ 산재보험 소음성 난청 장해등급 계산</h2>
            <p class="sub">입력 즉시 계산됩니다. (Enter를 누르면 오류를 팝업으로도 안내)</p>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn secondary" id="btnGradeClear">초기화</button>
          </div>
        </div>

        <div class="card">
          <div class="grid cols4">
            <div class="field">
              <label for="ldb">좌 dB</label>
              <input class="input" id="ldb" inputmode="decimal" placeholder="예: 60" />
              <div class="help">숫자만</div>
            </div>
            <div class="field">
              <label for="rdb">우 dB</label>
              <input class="input" id="rdb" inputmode="decimal" placeholder="예: 50" />
              <div class="help">숫자만</div>
            </div>
            <div class="field">
              <label for="lsp">좌 어음(%)</label>
              <input class="input" id="lsp" inputmode="decimal" placeholder="예: 70 또는 0.7" />
              <div class="help">70(%) 또는 0.7(비율)</div>
            </div>
            <div class="field">
              <label for="rsp">우 어음(%)</label>
              <input class="input" id="rsp" inputmode="decimal" placeholder="예: 50 또는 0.5" />
              <div class="help">둘 중 큰 값 적용</div>
            </div>
          </div>

          <div class="line"></div>

          <div class="grid cols3">
            <div class="field">
              <label for="usedSp">적용 어음(%)</label>
              <input class="input" id="usedSp" readonly />
              <div class="help">입력된 좌/우 어음 중 큰 값</div>
            </div>
            <div class="field" style="grid-column: span 2;">
              <label>결과</label>
              <div class="resultBox" id="gradeResult">
                값이 입력되면 결과가 표시됩니다.
                <div class="muted" id="gradeDetail"></div>
              </div>
              <div class="err" id="gradeErr" style="display:none;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- SIX -->
      <section class="page" id="page-six">
        <div class="sectionTitle">
          <div>
            <h2>※ 청력검사 6분법 평균 계산</h2>
            <p class="sub">각 칸에 숫자를 입력하면 평균(내림) 결과가 자동 반영됩니다.</p>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn secondary" id="btnSixClear">초기화</button>
          </div>
        </div>

        <div class="sessions" id="sixContainer"></div>

        <div style="margin-top:14px; color:var(--muted); font-weight:700; font-size:12px;">
          ※ 계산식: (500 + 1000×2 + 2000×2 + 4000) ÷ 6, 소수점 내림, 최대 100
        </div>
      </section>

      <!-- JANGHAE -->
      <section class="page" id="page-janghae">
        <div class="sectionTitle">
          <div>
            <h2>※ 장해 일시금·연금 계산기</h2>
            <p class="sub">등급/방식/평균임금 입력 → 산정일수 및 금액 계산 (예상값 비교 포함)</p>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn secondary" id="btnJanghaeClear">초기화</button>
          </div>
        </div>

        <div class="card">
          <div class="grid cols3">
            <div class="field">
              <label for="jhLevel">장해등급</label>
              <select class="input" id="jhLevel"></select>
              <div class="help">1급~14급</div>
            </div>

            <div class="field">
              <label for="jhType">연금/일시금</label>
              <select class="input" id="jhType">
                <option value="일시금">일시금</option>
                <option value="연금">연금</option>
              </select>
              <div class="help">1~3급은 원칙적으로 연금(안내는 하단 참고)</div>
            </div>

            <div class="field">
              <label for="jhWage">평균임금</label>
              <input class="input" id="jhWage" inputmode="decimal" placeholder="예: 120,000" />
              <div class="help">콤마 입력 가능</div>
            </div>
          </div>

          <div class="line"></div>

          <div class="grid cols3">
            <div class="field">
              <label for="jhDays">산정일수</label>
              <input class="input" id="jhDays" readonly />
              <div class="help">일시금/연금(1년치) 기준 산정일수</div>
            </div>

            <div class="field">
              <label id="jhPayLabel" for="jhPay">장해 일시금</label>
              <input class="input" id="jhPay" readonly />
              <div class="help">산정일수 × 평균임금</div>
            </div>

            <div class="field">
              <label id="jhMonthLabel" for="jhMonth">매 월 지급액</label>
              <input class="input" id="jhMonth" readonly />
              <div class="help">연금 선택 시만 표시</div>
            </div>
          </div>

          <div class="err" id="jhErr" style="display:none;"></div>

          <div class="resultBox" style="margin-top:14px;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
              <div style="font-weight:1000;">※ 참고사항</div>
              <span class="badge" id="jhBadge">자동 계산</span>
            </div>
            <div class="muted" id="jhNote" style="margin-top:8px;"></div>
          </div>

          <div class="line"></div>

          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div style="font-weight:1000;">장해 일시금·연금 비교 (예상값)</div>
            <div style="color:var(--muted); font-weight:700; font-size:12px;">선급(연금) 계산은 간편식(원본 로직 반영)</div>
          </div>

          <div style="margin-top:10px; overflow:auto;">
            <table class="miniTable">
              <thead>
                <tr>
                  <th>항목</th>
                  <th>값</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>일시금 선택 시 (최종)</td><td id="jhCmpLump">-</td></tr>
                <tr><td>연금 선택 시 (1년치)</td><td id="jhCmpAnn">-</td></tr>
                <tr><td>→ 매 월 (연금)</td><td id="jhCmpAnnM">-</td></tr>

                <tr><td>연금 1년 선급</td><td id="jhAdv1">-</td></tr>
                <tr><td>연금 2년 선급</td><td id="jhAdv2">-</td></tr>
                <tr><td>연금 3년 선급</td><td id="jhAdv3">-</td></tr>
                <tr><td>연금 4년 선급</td><td id="jhAdv4">-</td></tr>
                <tr><td>선급 후 → 매 월</td><td id="jhAdvM">-</td></tr>
              </tbody>
            </table>
          </div>

          <div style="margin-top:12px; color:var(--muted); font-weight:700; font-size:12px;">
            ※ 본 계산기는 편의상 원본 프로그램의 산정일수 테이블 기반으로 계산합니다. 실제 지급은 관계 법령/판정 및 지급 당시 기준에 따를 수 있습니다.
          </div>
        </div>
      </section>

    </div>
  </main>

  <script>
    // -----------------------------
    // routing
    // -----------------------------
    const pages = {
      home: document.getElementById("page-home"),
      grade: document.getElementById("page-grade"),
      six: document.getElementById("page-six"),
      janghae: document.getElementById("page-janghae"),
    };

    function applyPage(pageKey){
      Object.values(pages).forEach(p => p.classList.remove("active"));
      (pages[pageKey] || pages.home).classList.add("active");
      window.scrollTo({ top: 0, behavior: "auto" });
    }
    
    function go(pageKey){
      // 홈은 해시를 지워서 "목차가 기본"이 되게 함
      if(pageKey === "home"){
        applyPage("home");
        history.pushState({}, "", location.pathname); // ✅ 해시 제거 + 히스토리 유지
        return;
      }
    
      // 계산기들은 해시를 바꿔서 히스토리가 쌓이게 함 (뒤로가기 가능)
      location.hash = "#" + pageKey; // ✅ 이게 포인트
    }
    
    function syncFromHash(){
      const key = (location.hash || "").replace("#","");
    
      // 해시가 없으면 목차
      if(!key){
        applyPage("home");
        return;
      }
    
      // 유효한 해시(#grade/#six/#janghae 등)면 해당 페이지 표시
      if(pages[key]) applyPage(key);
      else applyPage("home");
    }


    document.getElementById("btnHome").addEventListener("click", () => go("home"));
    document.querySelectorAll("[data-go]").forEach(btn=>{
      btn.addEventListener("click", () => go(btn.getAttribute("data-go")));
    });

    window.addEventListener("hashchange", syncFromHash);
    document.getElementById("btnPrint").addEventListener("click", () => window.print());

    // -----------------------------
    // 공용 유틸
    // -----------------------------
    function toFloat(s){
      s = (s ?? "").toString().trim();
      if(!s) return null;
      s = s.replaceAll(",", "");
      const v = Number(s);
      return Number.isFinite(v) ? v : null;
    }
    function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }

    function fmtMoney(x){
      if (typeof x === "string") return x;
      if (!Number.isFinite(x)) return "-";
      return x.toLocaleString("ko-KR");
    }

    // -----------------------------
    // 1) 장해등급 로직
    // -----------------------------
    const DB_LEVELS = [0, 40, 50, 60, 70, 80, 90];
    const SPEECH_LEVELS = [0.3, 0.5, 0.7, 1.0];

    const RESULT_MATRIX = [
      [
        ["무장해","무장해","무장해","무장해"],
        ["제14급 제1호","제14급 제1호","제14급 제1호","제14급 제1호"],
        ["제11급 제4호","제11급 제4호","제14급 제1호","제14급 제1호"],
        ["제11급 제4호","제11급 제4호","제14급 제1호","제14급 제1호"],
        ["제11급 제4호","제11급 제4호","제11급 제4호","제11급 제4호"],
        ["제10급 제6호","제10급 제6호","제10급 제6호","제10급 제6호"],
        ["제9급 제9호","제9급 제9호","제9급 제9호","제9급 제9호"]
      ],
      [
        ["제14급 제14호","제14급 제14호","제14급 제14호","제14급 제14호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제5호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제5호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제5호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제4호"],
        ["제10급 제6호","제10급 제6호","제10급 제6호","제10급 제6호"],
        ["제9급 제9호","제9급 제9호","제9급 제9호","제9급 제9호"]
      ],
      [
        ["제11급 제4호","제11급 제4호","제14급 제1호","제14급 제1호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제5호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제10급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제10급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제10급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제8호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제8호"]
      ],
      [
        ["제11급 제4호","제11급 제4호","제14급 제1호","제14급 제1호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제5호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제10급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제7호"],
        ["제6급 제3호","제7급 제2호","제7급 제3호","제7급 제3호"]
      ],
      [
        ["제11급 제4호","제11급 제4호","제11급 제4호","제11급 제4호"],
        ["제10급 제7호","제10급 제7호","제10급 제7호","제11급 제4호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제10급 제7호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제7호"],
        ["제6급 제3호","제7급 제2호","제7급 제2호","제7급 제2호"],
        ["제6급 제3호","제7급 제2호","제7급 제2호","제7급 제2호"],
        ["제6급 제3호","제6급 제4호","제6급 제4호","제6급 제4호"]
      ],
      [
        ["제10급 제6호","제10급 제6호","제10급 제6호","제10급 제6호"],
        ["제10급 제6호","제10급 제6호","제10급 제6호","제10급 제6호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제8호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제7호"],
        ["제6급 제3호","제7급 제2호","제7급 제2호","제7급 제2호"],
        ["제4급 제3호","제6급 제3호","제6급 제3호","제6급 제3호"],
        ["제4급 제3호","제6급 제3호","제6급 제3호","제6급 제3호"]
      ],
      [
        ["제9급 제9호","제9급 제9호","제9급 제9호","제9급 제9호"],
        ["제9급 제9호","제9급 제9호","제9급 제9호","제9급 제9호"],
        ["제6급 제3호","제7급 제2호","제9급 제7호","제9급 제8호"],
        ["제6급 제3호","제7급 제2호","제7급 제3호","제7급 제3호"],
        ["제6급 제3호","제6급 제4호","제6급 제4호","제6급 제4호"],
        ["제4급 제3호","제6급 제3호","제6급 제3호","제6급 제3호"],
        ["제4급 제3호","제4급 제3호","제4급 제3호","제4급 제3호"]
      ]
    ];

    function bucketFloor(value, levels){
      let i = 0;
      for(let k=0;k<levels.length;k++){
        if(levels[k] <= value) i = k;
      }
      i = clamp(i, 0, levels.length-1);
      return { bucket: levels[i], idx: i };
    }
    function bucketCeil(value, levels){
      let i = levels.length-1;
      for(let k=0;k<levels.length;k++){
        if(levels[k] >= value){ i = k; break; }
      }
      i = clamp(i, 0, levels.length-1);
      return { bucket: levels[i], idx: i };
    }
    function speechToFraction(x){
      let frac = (x <= 1.0) ? x : (x / 100.0);
      return clamp(frac, 0.0, 1.0);
    }

    const elLdb = document.getElementById("ldb");
    const elRdb = document.getElementById("rdb");
    const elLsp = document.getElementById("lsp");
    const elRsp = document.getElementById("rsp");
    const elUsedSp = document.getElementById("usedSp");
    const elGradeResult = document.getElementById("gradeResult");
    const elGradeDetail = document.getElementById("gradeDetail");
    const elGradeErr = document.getElementById("gradeErr");

    function setGradeMessage(msg, detail=""){
      elGradeResult.firstChild.textContent = msg;
      elGradeDetail.textContent = detail;
    }
    function showGradeErr(msg, popup=false){
      elGradeErr.style.display = "block";
      elGradeErr.textContent = msg;
      setGradeMessage("입력 오류가 있습니다.", "");
      elUsedSp.value = "";
      if(popup) alert(msg);
    }
    function clearGradeErr(){
      elGradeErr.style.display = "none";
      elGradeErr.textContent = "";
    }

    function calcGrade(showPopup=false){
      clearGradeErr();

      const rawPairs = [
        [elLdb.value, "좌 dB"],
        [elRdb.value, "우 dB"],
        [elLsp.value, "좌 어음명료도"],
        [elRsp.value, "우 어음명료도"],
      ];
      for(const [raw,name] of rawPairs){
        if(raw.trim() && toFloat(raw) === null){
          return showGradeErr(`${name} : 숫자만 입력하세요.`, showPopup);
        }
      }

      const ldb = toFloat(elLdb.value);
      const rdb = toFloat(elRdb.value);
      const lsp = toFloat(elLsp.value);
      const rsp = toFloat(elRsp.value);

      if(ldb === null || rdb === null || (lsp === null && rsp === null)){
        setGradeMessage("값이 입력되면 결과가 표시됩니다.", "");
        elUsedSp.value = "";
        return;
      }

      const usedSp = Math.max(...[lsp, rsp].filter(v => v !== null));
      const usedFrac = speechToFraction(usedSp);
      elUsedSp.value = String(Math.round(usedFrac * 100));

      const ldbB = bucketFloor(clamp(ldb, 0, 9999), DB_LEVELS);
      const rdbB = bucketFloor(clamp(rdb, 0, 9999), DB_LEVELS);
      const spB  = bucketCeil(usedFrac, SPEECH_LEVELS);

      const result = RESULT_MATRIX[rdbB.idx][ldbB.idx][spB.idx];

      setGradeMessage(
        `해당 급수는: ${result}`,
        `(좌 ${ldbB.bucket}dB / 우 ${rdbB.bucket}dB / 어음 ${Math.round(spB.bucket*100)}%)`
      );
    }

    [elLdb, elRdb, elLsp, elRsp].forEach(el=>{
      el.addEventListener("input", () => calcGrade(false));
      el.addEventListener("keydown", (e)=>{
        if(e.key === "Enter"){
          e.preventDefault();
          calcGrade(true);
        }
      });
    });

    document.getElementById("btnGradeClear").addEventListener("click", ()=>{
      [elLdb, elRdb, elLsp, elRsp].forEach(el => el.value = "");
      elUsedSp.value = "";
      clearGradeErr();
      setGradeMessage("값이 입력되면 결과가 표시됩니다.", "");
      elLdb.focus();
    });

    // -----------------------------
    // 2) 6분법 UI + 탭 순서
    // -----------------------------
    const sixContainer = document.getElementById("sixContainer");
    const freqs = ["500Hz", "1000Hz", "2000Hz", "4000Hz"];

    function makeInput(id){
      const inp = document.createElement("input");
      inp.type = "text";
      inp.className = "input";
      inp.id = id;
      inp.inputMode = "decimal";
      inp.placeholder = "0";
      return inp;
    }

    function safeNum(v){
      const x = toFloat(v);
      if(x === null) return 0;
      return Math.max(0, x);
    }

    function calcSixBlock(blockEl){
      const inputs = freqs.map((_,i)=> blockEl.querySelector(`[data-f="${i}"]`));
      const out = blockEl.querySelector(`[data-out="1"]`);

      const v1 = safeNum(inputs[0].value);
      const v2 = safeNum(inputs[1].value);
      const v3 = safeNum(inputs[2].value);
      const v4 = safeNum(inputs[3].value);

      let result = (v1 + v2*2 + v3*2 + v4) / 6;
      result = Math.floor(result);
      result = Math.min(result, 100);

      out.value = String(result);
    }

    function buildSixUI(){
      const sessions = [
        { n: 1, leftId: "s1L", rightId: "s1R" },
        { n: 2, leftId: "s2L", rightId: "s2R" },
        { n: 3, leftId: "s3L", rightId: "s3R" },
      ];

      let tabCounter = 1;

      sessions.forEach(s=>{
        const sessionCard = document.createElement("div");
        sessionCard.className = "sessionCard";

        const head = document.createElement("div");
        head.className = "sessionHead";
        head.innerHTML = `<div class="sTitle">${s.n}회차</div><div style="color:var(--muted); font-weight:800; font-size:12px;">좌/우 입력</div>`;
        sessionCard.appendChild(head);

        const pair = document.createElement("div");
        pair.className = "pair";

        const makeEar = (label, key) => {
          const ear = document.createElement("div");
          ear.className = "earBlock";

          const title = document.createElement("div");
          title.className = "earTitle";
          title.innerHTML = `<span>${label}</span><span>결과</span>`;
          ear.appendChild(title);

          const fg = document.createElement("div");
          fg.className = "freqGrid";

          freqs.forEach((f, i)=>{
            const row = document.createElement("div");
            row.className = "row";

            const left = document.createElement("div");
            left.className = "freq";
            left.textContent = f;

            const inp = makeInput(`${key}_${i}`);
            inp.setAttribute("data-f", String(i));
            inp.tabIndex = tabCounter++;

            row.appendChild(left);
            row.appendChild(inp);
            fg.appendChild(row);
          });

          const rowOut = document.createElement("div");
          rowOut.className = "row";

          const outLabel = document.createElement("div");
          outLabel.className = "freq";
          outLabel.textContent = "평균";

          const out = document.createElement("input");
          out.type = "text";
          out.className = "input";
          out.setAttribute("data-out", "1");
          out.readOnly = true;
          out.tabIndex = -1;

          rowOut.appendChild(outLabel);
          rowOut.appendChild(out);
          fg.appendChild(rowOut);

          ear.appendChild(fg);

          ear.querySelectorAll("input[data-f]").forEach(inp=>{
            inp.addEventListener("input", ()=> calcSixBlock(ear));
          });

          return ear;
        };

        pair.appendChild(makeEar("좌(X,□)", s.leftId));
        pair.appendChild(makeEar("우(○,△)", s.rightId));

        sessionCard.appendChild(pair);
        sixContainer.appendChild(sessionCard);
      });
    }

    buildSixUI();

    // ✅ 포커스 안전장치
    sixContainer.addEventListener("pointerdown", (e) => {
      const t = e.target;
      if (t && t.tagName === "INPUT" && !t.readOnly) t.focus();
    }, { passive: true });

    document.getElementById("btnSixClear").addEventListener("click", ()=>{
      sixContainer.querySelectorAll("input.input:not([readonly])").forEach(inp => inp.value = "");
      sixContainer.querySelectorAll(".earBlock").forEach(block => calcSixBlock(block));
      const first = sixContainer.querySelector("input.input:not([readonly])");
      if(first) first.focus();
    });

    // 초기 결과 0
    sixContainer.querySelectorAll(".earBlock").forEach(block => calcSixBlock(block));

    // -----------------------------
    // 3) 장해 일시금·연금 계산기
    // -----------------------------
    const jhLevel = document.getElementById("jhLevel");
    const jhType  = document.getElementById("jhType");
    const jhWage  = document.getElementById("jhWage");

    const jhDays  = document.getElementById("jhDays");
    const jhPay   = document.getElementById("jhPay");
    const jhMonth = document.getElementById("jhMonth");

    const jhPayLabel   = document.getElementById("jhPayLabel");
    const jhMonthLabel = document.getElementById("jhMonthLabel");
    const jhNote  = document.getElementById("jhNote");
    const jhErr   = document.getElementById("jhErr");
    const jhBadge = document.getElementById("jhBadge");

    const jhCmpLump = document.getElementById("jhCmpLump");
    const jhCmpAnn  = document.getElementById("jhCmpAnn");
    const jhCmpAnnM = document.getElementById("jhCmpAnnM");
    const jhAdv1    = document.getElementById("jhAdv1");
    const jhAdv2    = document.getElementById("jhAdv2");
    const jhAdv3    = document.getElementById("jhAdv3");
    const jhAdv4    = document.getElementById("jhAdv4");
    const jhAdvM    = document.getElementById("jhAdvM");

    // 등급 선택 옵션(14→1)
    (function initJHLevel(){
      const vals = [];
      for(let i=14;i>=1;i--) vals.push(i);
      vals.forEach(v=>{
        const opt = document.createElement("option");
        opt.value = String(v);
        opt.textContent = String(v);
        jhLevel.appendChild(opt);
      });
      jhLevel.value = "14";
    })();

    // 원본 로직 기반 산정일수 테이블
    const JH_DAYS = {
      1: { ann: 329, lump: 1474 },
      2: { ann: 291, lump: 1309 },
      3: { ann: 257, lump: 1155 },
      4: { ann: 224, lump: 1012 },
      5: { ann: 193, lump: 869  },
      6: { ann: 164, lump: 737  },
      7: { ann: 138, lump: 616  },
      8: { ann: null, lump: 495  },
      9: { ann: null, lump: 385  },
      10:{ ann: null, lump: 297  },
      11:{ ann: null, lump: 220  },
      12:{ ann: null, lump: 154  },
      13:{ ann: null, lump: 99   },
      14:{ ann: null, lump: 55   },
    };

    function setJhErr(msg){
      jhErr.style.display = "block";
      jhErr.textContent = msg;
      jhBadge.textContent = "입력 오류";
    }
    function clearJhErr(){
      jhErr.style.display = "none";
      jhErr.textContent = "";
      jhBadge.textContent = "자동 계산";
    }

    function calcJanghae(){
      clearJhErr();

      const level = Number(jhLevel.value);
      const type  = jhType.value;
      const wageV = toFloat(jhWage.value);

      // 입력 검사
      if (jhWage.value.trim() && wageV === null){
        setJhErr("평균임금: 숫자만 입력하세요.");
        return;
      }
      if (wageV === null){
        // 아직 미입력
        jhDays.value = "";
        jhPay.value = "";
        jhMonth.value = "";
        jhNote.textContent = "평균임금을 입력하면 결과가 표시됩니다.";
        jhCmpLump.textContent = "-";
        jhCmpAnn.textContent  = "-";
        jhCmpAnnM.textContent = "-";
        jhAdv1.textContent = jhAdv2.textContent = jhAdv3.textContent = jhAdv4.textContent = jhAdvM.textContent = "-";
        return;
      }

      const info = JH_DAYS[level];
      if (!info){
        setJhErr("장해등급을 확인해주세요.");
        return;
      }

      const annDays  = info.ann;
      const lumpDays = info.lump;

      // 참고문구
      let note = "";
      if (level <= 3){
        note = "※참고사항※\n\n* 1급부터 3급까지는 장해연금으로 지급(원칙)\n\n* 연금으로 지급시, 연금 지급 당시 평균임금 기준으로 산정";
      } else if (level <= 7){
        note = "※참고사항※\n\n* 장해4급~7급은 산재근로자의 선택에 따라 일시금 또는 연금으로 지급\n\n* 연금으로 지급시, 연금 지급 당시 평균임금 기준으로 산정";
      } else {
        note = "※참고사항※\n\n* 장해8급 이하는 연금 선택 불가 (일시금만 선택 가능)\n\n* 재요양 후 장해급여 산정 평균임금은 종전 기준의 증감분을 적용(원본 로직 안내)";
      }
      jhNote.textContent = note;

      // 메인 결과
      if (type === "연금"){
        if (annDays == null){
          setJhErr("해당 등급은 연금 선택이 불가합니다. (8급 이하)");
          jhDays.value = "연금선택 불가";
          jhPayLabel.textContent = "연금액(1년치)";
          jhPay.value = "연금선택 불가";
          jhMonthLabel.textContent = "매 월 지급액";
          jhMonth.value = "";
        } else {
          jhPayLabel.textContent = "연금액(1년치)";
          jhMonthLabel.textContent = "매 월 지급액";
          jhDays.value = String(annDays);
          const yearPay = annDays * wageV;
          const monthPay = yearPay / 12;
          jhPay.value = fmtMoney(Math.round(yearPay));
          jhMonth.value = fmtMoney(Math.round(monthPay));
        }
      } else { // 일시금
        jhPayLabel.textContent = "장해 일시금";
        jhMonthLabel.textContent = "매 월 지급액";
        jhMonth.value = "";
        jhDays.value = String(lumpDays);
        const lumpPay = lumpDays * wageV;
        jhPay.value = fmtMoney(Math.round(lumpPay));
      }

      // 비교(예상값)
      const lumpTotal = lumpDays * wageV;
      jhCmpLump.textContent = fmtMoney(Math.round(lumpTotal));

      if (annDays == null){
        jhCmpAnn.textContent = "연금선택 불가";
        jhCmpAnnM.textContent = "연금선택 불가";
        jhAdv1.textContent = jhAdv2.textContent = jhAdv3.textContent = jhAdv4.textContent = jhAdvM.textContent = "연금선택 불가";
        return;
      }

      const annTotal = annDays * wageV;
      jhCmpAnn.textContent  = fmtMoney(Math.round(annTotal));
      jhCmpAnnM.textContent = fmtMoney(Math.round(annTotal/12));

      // 선급(원본 로직 반영)
      const adv = (years) => Math.round((annDays * wageV * years) / 2); // (result*wage*years)/2
      const isAdvanceAllowed = (years) => {
        // 원본: 4~7급은 3~4년 선급 불가
        if (level >= 4 && level <= 7 && years >= 3) return false;
        // 8급 이하는 애초에 연금 없음
        return true;
      };

      const adv1 = isAdvanceAllowed(1) ? adv(1) : "선급 불가";
      const adv2 = isAdvanceAllowed(2) ? adv(2) : "선급 불가";
      const adv3 = isAdvanceAllowed(3) ? adv(3) : "선급 불가";
      const adv4 = isAdvanceAllowed(4) ? adv(4) : "선급 불가";

      jhAdv1.textContent = typeof adv1 === "string" ? adv1 : fmtMoney(adv1);
      jhAdv2.textContent = typeof adv2 === "string" ? adv2 : fmtMoney(adv2);
      jhAdv3.textContent = typeof adv3 === "string" ? adv3 : fmtMoney(adv3);
      jhAdv4.textContent = typeof adv4 === "string" ? adv4 : fmtMoney(adv4);

      // 선급 후 매월: 원본에서 일부 등급 계산이 달라 보이지만, 안정적으로 "4년 선급 기준"만 표시
      // (4년 선급 불가면 '-')
      if (typeof adv4 === "string"){
        jhAdvM.textContent = "-";
      } else {
        jhAdvM.textContent = fmtMoney(Math.round(adv4 / 12));
      }
    }

    // 이벤트 바인딩
    [jhLevel, jhType].forEach(el => el.addEventListener("change", calcJanghae));
    jhWage.addEventListener("input", calcJanghae);
    jhWage.addEventListener("keydown", (e)=>{
      if (e.key === "Enter"){
        e.preventDefault();
        calcJanghae();
      }
    });

    document.getElementById("btnJanghaeClear").addEventListener("click", ()=>{
      jhLevel.value = "14";
      jhType.value = "일시금";
      jhWage.value = "";
      calcJanghae();
      jhWage.focus();
    });

    // 최초 진입
    syncFromHash();
    // 장해 페이지 초기 안내
    calcJanghae();
  </script>
</body>
</html>
